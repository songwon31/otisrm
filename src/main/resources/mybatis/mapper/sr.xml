<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finalteam5.otisrm.dao.SrDao">
	<select id="countSr" resultType="int">
		count * from sr
	</select>
	
	<select id="countTotalTransferedSrNumByUsrId" parameterType="String" resultType="int">
		SELECT count(*)
		FROM usr u1
		JOIN sr_trnsf_plan srt ON u1.usr_no = srt.usr_no
		JOIN sr ON srt.sr_no = sr.sr_no
		JOIN usr u2 ON sr.pic_usr_no = u2.usr_no
		JOIN sr_rqst srr ON sr.sr_rqst_no = srr.sr_rqst_no
		JOIN sys ON srr.sys_no = sys.sys_no
		JOIN sr_dmnd_clsf srd ON srt.sr_dmnd_no = srd.sr_dmnd_no
		JOIN sr_prgrs_stts srp ON srt.sr_prgrs_stts_no = srp.sr_prgrs_stts_no
		JOIN sr_prgrs srpr ON srt.sr_no = srpr.sr_no
		JOIN usr u3 ON srpr.usr_no = u3.usr_no
		WHERE u1.usr_id = #{usrId} OR (u3.usr_id = #{usrId} AND srt.sr_prgrs_stts_no = srpr.sr_prgrs_stts_no)
	</select>
	
	<select id="selectSrForDeveloperHomeBoardListByUsrId" parameterType="String" resultType="com.finalteam5.otisrm.dto.sr.SrForDeveloperHomeBoard">
		SELECT sr.sr_no, sys.sys_nm, srd.sr_dmnd_nm, srr.sr_ttl, u2.usr_nm, sr.sr_cmptn_prnmnt_dt, srt.sr_trgt_cmptn_dt, srp.sr_prgrs_stts_nm
		FROM usr u1
		JOIN sr_trnsf_plan srt ON u1.usr_no = srt.usr_no
		JOIN sr ON srt.sr_no = sr.sr_no
		JOIN usr u2 ON sr.pic_usr_no = u2.usr_no
		JOIN sr_rqst srr ON sr.sr_rqst_no = srr.sr_rqst_no
		JOIN sys ON srr.sys_no = sys.sys_no
		JOIN sr_dmnd_clsf srd ON srt.sr_dmnd_no = srd.sr_dmnd_no
		JOIN sr_prgrs_stts srp ON srt.sr_prgrs_stts_no = srp.sr_prgrs_stts_no
		JOIN sr_prgrs srpr ON srt.sr_no = srpr.sr_no
		JOIN usr u3 ON srpr.usr_no = u3.usr_no
		WHERE u1.usr_id = #{usrId} OR (u3.usr_id = #{usrId} AND srt.sr_prgrs_stts_no = srpr.sr_prgrs_stts_no)
		ORDER BY sr.sr_no
	</select>
	
	<select id="selectSrForDeveloperHomeBoardListByUsrIdAndPager" parameterType="map" resultType="com.finalteam5.otisrm.dto.sr.SrForDeveloperHomeBoard">
		<![CDATA[
		SELECT rnum, sr_no, sys_nm, sr_dmnd_nm, sr_ttl, usr_nm, sr_cmptn_prnmnt_dt, sr_trgt_cmptn_dt, sr_prgrs_stts_nm
		FROM(
			SELECT rownum as rnum, sr_no, sys_nm, sr_dmnd_nm, sr_ttl, usr_nm, sr_cmptn_prnmnt_dt, sr_trgt_cmptn_dt, sr_prgrs_stts_nm
			FROM (	
				SELECT sr.sr_no, sys.sys_nm, srd.sr_dmnd_nm, srr.sr_ttl, u2.usr_nm, sr.sr_cmptn_prnmnt_dt, srt.sr_trgt_cmptn_dt, srp.sr_prgrs_stts_nm
				FROM usr u1
				JOIN sr_trnsf_plan srt ON u1.usr_no = srt.usr_no
				JOIN sr ON srt.sr_no = sr.sr_no
				JOIN usr u2 ON sr.pic_usr_no = u2.usr_no
				JOIN sr_rqst srr ON sr.sr_rqst_no = srr.sr_rqst_no
				JOIN sys ON srr.sys_no = sys.sys_no
				JOIN sr_dmnd_clsf srd ON srt.sr_dmnd_no = srd.sr_dmnd_no
				JOIN sr_prgrs_stts srp ON srt.sr_prgrs_stts_no = srp.sr_prgrs_stts_no
				JOIN sr_prgrs srpr ON srt.sr_no = srpr.sr_no
				JOIN usr u3 ON srpr.usr_no = u3.usr_no
				WHERE u1.usr_id = #{usrId} OR (u3.usr_id = #{usrId} AND srt.sr_prgrs_stts_no = srpr.sr_prgrs_stts_no)
				ORDER BY sr.sr_no
			)
			WHERE rownum <= #{pager.endRowNo}
		)
		where rnum >= #{pager.startRowNo}
		]]>
	</select>
	
	<select id="selectSrTrnsfInfoForDeveloperHomeBySrNo" parameterType="String" resultType="com.finalteam5.otisrm.dto.sr.SrTrnsfInfoForDeveloperHome">
		SELECT srd.sr_dmnd_nm, srk.sr_task_nm, inst.inst_nm, dept.dept_nm, usr.usr_nm, srt.sr_trgt_bgng_dt, srt.sr_trgt_cmptn_dt, srt.sr_trnsf_note
		FROM sr_trnsf_plan srt
		JOIN sr ON srt.sr_no = sr.sr_no
		JOIN usr ON srt.usr_no = usr.usr_no
		JOIN sr_dmnd_clsf srd ON srt.sr_dmnd_no = srd.sr_dmnd_no
		JOIN sr_task_clsf srk ON sr.sr_task_no = srk.sr_task_no
		JOIN inst ON srt.inst_no = inst.inst_no
		JOIN dept ON srt.dept_no = dept.dept_no
		WHERE srt.sr_no = #{srNo}
	</select>
	
	<select id="selectSrPrgrsForDeveloperHomeList" parameterType="String" resultType="com.finalteam5.otisrm.dto.sr.SrPrgrsForDeveloperHome">
		SELECT srps.sr_prgrs_stts_nm, srp.sr_prgrs_bgng_dt, srp.sr_prgrs_cmptn_dt, srp.sr_prgrs, usr.usr_no, usr.usr_nm, role.role_nm
		FROM sr_prgrs srp
		JOIN sr_prgrs_stts srps ON srp.sr_prgrs_stts_no = srps.sr_prgrs_stts_no
		JOIN usr ON srp.usr_no = usr.usr_no
		JOIN role ON usr.role_no = role.role_no
		WHERE srp.sr_no = #{srNo}
		ORDER BY srps.sr_prgrs_stts_seq asc
	</select>
	
	<select id="selectSrRequestDetailForDeveloperHome" parameterType="String" resultType="com.finalteam5.otisrm.dto.sr.SrRequestDetailForDeveloperHome">
		SELECT
		FROM sr
		JOIN sr_rqst srr ON sr.sr_rqst_no = srr.sr_rqst_no
		JOIN dept ON 
		WHERE sr.sr_no = #{srNo}
	</select>
</mapper>